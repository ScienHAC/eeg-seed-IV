<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Guide to the SEED-IV Dataset</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Cool Slate & Indigo -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 40vh;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        .section-fade-in {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        .section-fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .nav-link {
            transition: color 0.2s;
        }
        .nav-link:hover {
            color: #4f46e5; /* indigo-600 */
        }
        .active-nav-link {
            color: #4f46e5;
            font-weight: 600;
        }
        .llm-loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Style for the CSV data table */
        #csv-data-display table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            font-size: 0.875rem; /* text-sm */
        }
        #csv-data-display th, #csv-data-display td {
            border: 1px solid #e2e8f0; /* slate-200 */
            padding: 0.5rem;
            text-align: left;
        }
        #csv-data-display th {
            background-color: #f1f5f9; /* slate-100 */
            font-weight: 600;
            color: #334155; /* slate-700 */
        }
        #csv-data-display tbody tr:nth-child(even) {
            background-color: #f8fafc; /* slate-50 */
        }
    </style>
</head>
<body class="text-slate-700">

    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 border-b border-slate-200">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <span class="font-bold text-xl text-slate-800">SEED-IV Explorer</span>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">                        <a href="#overview" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-slate-600">Overview</a>
                        <a href="#design" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-slate-600">Experiment Design</a>
                        <a href="#features" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-slate-600">Data & Features</a>
                        <a href="#data-structure" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-slate-600">Dataset Structure</a>
                        <a href="#explorer" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-slate-600">Interactive Explorer</a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        
        <section id="overview" class="text-center py-16 section-fade-in">
            <h1 class="text-4xl md:text-5xl font-bold text-slate-900 tracking-tight">An Interactive Guide to the SEED-IV Dataset</h1>
            <p class="mt-4 max-w-3xl mx-auto text-lg text-slate-600">Explore the structure, features, and methodology of the SEED-IV dataset, a key resource for multimodal emotion recognition research using EEG and Eye Tracking data.</p>
            
            <div class="mt-12 grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-8 max-w-4xl mx-auto">
                <div class="bg-white p-6 rounded-xl shadow-md border border-slate-100">
                    <p class="text-4xl font-bold text-indigo-600">4</p>
                    <p class="mt-2 text-sm font-medium text-slate-500">Target Emotions</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md border border-slate-100">
                    <p class="text-4xl font-bold text-indigo-600">15</p>
                    <p class="mt-2 text-sm font-medium text-slate-500">Subjects</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md border border-slate-100">
                    <p class="text-4xl font-bold text-indigo-600">62</p>
                    <p class="mt-2 text-sm font-medium text-slate-500">EEG Channels</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md border border-slate-100">
                    <p class="text-4xl font-bold text-indigo-600">2</p>
                    <p class="mt-2 text-sm font-medium text-slate-500">Data Modalities</p>
                </div>
            </div>
        </section>

        <section id="design" class="py-16 section-fade-in">
            <div class="text-center">
                <h2 class="text-3xl font-bold text-slate-900 tracking-tight">The Experimental Design</h2>
                <p class="mt-4 max-w-2xl mx-auto text-lg text-slate-600">The dataset was collected through a carefully structured experiment to ensure data quality and reliable emotion induction. The process involved multiple subjects, sessions, and trials.</p>
            </div>

            <div class="mt-12 grid md:grid-cols-2 gap-12 items-center">
                <div>
                    <h3 class="text-xl font-semibold text-slate-800">Participant Demographics</h3>
                    <p class="mt-2 text-slate-600">A total of 15 subjects participated, with a mix of genders, allowing for studies on demographic variations in emotional response.</p>
                    <div class="mt-4 chart-container h-64 md:h-80">
                        <canvas id="demographicsChart"></canvas>
                    </div>
                </div>
                <div>
                    <h3 class="text-xl font-semibold text-slate-800">Experiment Flow</h3>
                     <p class="mt-2 text-slate-600">Each participant underwent three sessions on different days. In each session, they viewed 24 film clips (trials) designed to elicit specific emotions while their physiological data was recorded. Hover over the steps to learn more.</p>
                    <div class="mt-4 space-y-4">
                        <div class="p-4 bg-white rounded-lg shadow-sm border border-slate-200 group" title="A single person from the pool of 15 subjects.">
                            <p class="font-semibold text-slate-800">1. Subject</p>
                        </div>
                        <div class="pl-8 relative">
                             <span class="absolute left-4 top-4 bottom-4 w-px bg-slate-300"></span>
                             <div class="p-4 bg-white rounded-lg shadow-sm border border-slate-200 relative group" title="Each subject participated in 3 sessions on different days to ensure data robustness.">
                                <p class="font-semibold text-slate-800">2. Session (x3)</p>
                            </div>
                            <div class="pl-8 mt-4 relative">
                                <span class="absolute left-4 top-4 bottom-4 w-px bg-slate-300"></span>
                                <div class="p-4 bg-white rounded-lg shadow-sm border border-slate-200 relative group" title="In each session, the subject watched 24 different film clips. Each viewing is one trial.">
                                     <p class="font-semibold text-slate-800">3. Trial (x24)</p>
                                </div>
                                 <div class="pl-8 mt-4 relative">
                                     <span class="absolute left-4 top-4 bottom-4 w-px bg-slate-300"></span>
                                     <div class="p-4 bg-indigo-50 border-l-4 border-indigo-500 rounded-lg relative group" title="During each trial, 62-channel EEG and Eye Movement data were recorded simultaneously.">
                                          <p class="font-semibold text-indigo-800">4. Data Recording</p>
                                          <p class="text-sm text-indigo-700">EEG & Eye Tracking</p>
                                     </div>
                                 </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="features" class="py-16 section-fade-in">
            <div class="text-center">
                <h2 class="text-3xl font-bold text-slate-900 tracking-tight">Data Modalities & Features</h2>
                <p class="mt-4 max-w-2xl mx-auto text-lg text-slate-600">The dataset provides rich, pre-processed features from two complementary physiological sources. Explore the details of each data type below.</p>
            </div>

            <div class="mt-8">
                <div class="flex justify-center border-b border-slate-300">
                    <button id="tab-eeg" class="px-6 py-3 font-semibold text-indigo-600 border-b-2 border-indigo-600">EEG Features</button>
                    <button id="tab-eye" class="px-6 py-3 font-semibold text-slate-500">Eye Movement Features</button>
                </div>

                <div id="content-eeg" class="mt-8">
                    <div class="grid md:grid-cols-2 gap-12">
                        <div>
                            <h3 class="text-xl font-semibold text-slate-800">EEG Frequency Bands</h3>
                            <p class="mt-2 text-slate-600">EEG features were extracted across five standard frequency bands. Click on a band to learn about its associated cognitive states, and use the LLM button for a deeper dive.</p>
                            <div class="mt-4 flex flex-wrap gap-2" id="eegBandButtons"></div>
                            <div id="eegBandInfo" class="mt-4 p-4 bg-indigo-50 rounded-lg min-h-[100px] transition-all">
                                <p class="font-semibold text-indigo-800">Select a band above.</p>
                                <button id="eegBandDeepDiveBtn" class="mt-2 px-3 py-1.5 text-sm font-medium bg-indigo-600 text-white rounded-full hover:bg-indigo-700 transition-colors hidden">✨ Deep Dive</button>
                                <div id="eegBandDeepDiveResult" class="mt-2 text-sm text-indigo-900"></div>
                                <div id="eegBandDeepDiveLoading" class="mt-2 hidden flex items-center justify-center">
                                    <div class="llm-loading-spinner"></div>
                                </div>
                            </div>
                             <h3 class="text-xl font-semibold text-slate-800 mt-8">Feature Types</h3>
                            <p class="mt-2 text-slate-600">Two main feature types were extracted, then smoothed using two different methods to reduce noise.</p>
                            <div class="mt-4 grid grid-cols-2 gap-4">
                               <div class="p-4 bg-white rounded-lg shadow-sm border">
                                   <p class="font-bold text-slate-800">PSD</p>
                                   <p class="text-sm text-slate-500">Power Spectral Density - measures signal power at different frequencies.</p>
                               </div>
                               <div class="p-4 bg-white rounded-lg shadow-sm border">
                                   <p class="font-bold text-slate-800">DE</p>
                                   <p class="text-sm text-slate-500">Differential Entropy - measures signal complexity and randomness.</p>
                               </div>
                            </div>
                            
                            <!-- New EEG Abbreviations Table -->
                            <div class="mt-8">
                                <h4 class="text-lg font-semibold text-slate-800 mb-4">📖 EEG Feature Abbreviations Reference</h4>
                                <div class="overflow-x-auto bg-white rounded-lg shadow-sm border border-slate-200">
                                    <table class="min-w-full divide-y divide-slate-200">
                                        <thead class="bg-slate-50">
                                            <tr>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Abbreviation</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Full Form</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Meaning / Purpose</th>
                                            </tr>
                                        </thead>
                                        <tbody class="bg-white divide-y divide-slate-200">
                                            <tr class="hover:bg-slate-50">
                                                <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-indigo-600">DE</td>
                                                <td class="px-4 py-3 text-sm text-slate-900">Differential Entropy</td>
                                                <td class="px-4 py-3 text-sm text-slate-700">A feature extracted from EEG signals; reflects brain activity in frequency bands. Very effective for emotion recognition.</td>
                                            </tr>
                                            <tr class="hover:bg-slate-50">
                                                <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-indigo-600">PSD</td>
                                                <td class="px-4 py-3 text-sm text-slate-900">Power Spectral Density</td>
                                                <td class="px-4 py-3 text-sm text-slate-700">Another feature extraction method. Measures power distribution over frequency. Used to understand EEG energy in specific bands.</td>
                                            </tr>
                                            <tr class="hover:bg-slate-50">
                                                <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-green-600">MovingAve</td>
                                                <td class="px-4 py-3 text-sm text-slate-900">Moving Average</td>
                                                <td class="px-4 py-3 text-sm text-slate-700">A <strong>smoothing technique</strong> used to remove noise or fluctuations in EEG signals.</td>
                                            </tr>
                                            <tr class="hover:bg-slate-50">
                                                <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-green-600">LDS</td>
                                                <td class="px-4 py-3 text-sm text-slate-900">Linear Dynamical System</td>
                                                <td class="px-4 py-3 text-sm text-slate-700">A <strong>filtering/modeling technique</strong> to capture temporal patterns and reduce noise in time-series EEG data.</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="mt-3 p-3 bg-blue-50 rounded-lg border border-blue-200">
                                    <p class="text-sm text-blue-800">
                                        <span class="font-medium">💡 How they work together:</span> 
                                        Features like <span class="font-mono text-blue-900">de_LDS1</span> combine a feature extraction method (DE) with a smoothing technique (LDS). 
                                        This creates high-quality, noise-reduced features perfect for machine learning models.
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div>
                             <h3 class="text-xl font-semibold text-slate-800">Data Structure: 62 x W x 5</h3>
                             <p class="mt-2 text-slate-600">The extracted EEG features are stored in a 3D array. Hover over the dimensions below to understand what they represent.</p>
                             <div class="mt-4 p-4 bg-white rounded-lg shadow-sm border space-y-2">
                                <div class="dimension-block p-3 border-l-4 border-sky-500 bg-sky-50 rounded" data-desc="The 62 EEG channels, corresponding to different electrode locations on the scalp.">
                                    <span class="font-bold text-sky-800">Dimension 1: 62 Channels</span>
                                </div>
                                <div class="dimension-block p-3 border-l-4 border-amber-500 bg-amber-50 rounded" data-desc="The number of 4-second time windows (samples). This number 'W' varies because film clips have different lengths.">
                                    <span class="font-bold text-amber-800">Dimension 2: W Time Windows</span>
                                </div>
                                <div class="dimension-block p-3 border-l-4 border-violet-500 bg-violet-50 rounded" data-desc="The 5 frequency bands (Delta, Theta, Alpha, Beta, Gamma) for which features were calculated.">
                                    <span class="font-bold text-violet-800">Dimension 3: 5 Frequency Bands</span>
                                </div>
                                <p id="dimension-desc" class="mt-2 text-sm text-slate-600 min-h-[40px] italic">Hover over a dimension.</p>
                             </div>
                        </div>
                    </div>
                </div>

                <div id="content-eye" class="hidden mt-8">
                     <h3 class="text-xl font-semibold text-slate-800 text-center">Eye Movement Features</h3>
                     <p class="mt-2 text-slate-600 max-w-2xl mx-auto text-center">A rich set of features was extracted from eye tracking data, providing insights into attention, arousal, and cognitive load. Click on a feature type to see more details.</p>
                     <div id="eyeFeatureList" class="mt-6 max-w-2xl mx-auto space-y-2"></div>
                </div>            </div>
        </section>

        <section id="data-structure" class="py-16 section-fade-in bg-gradient-to-br from-slate-50 to-blue-50">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-slate-900 tracking-tight">📊 Dataset Structure & Research Overview</h2>
                <p class="mt-4 max-w-3xl mx-auto text-lg text-slate-600">Understanding how the SEED-IV dataset is organized and processed for emotion recognition research.</p>
            </div>

            <div class="space-y-8">
                <!-- Research Overview -->
                <div class="bg-white rounded-xl shadow-lg border border-slate-200 p-8">
                    <h3 class="text-2xl font-bold text-slate-900 mb-6">🔬 Research Context</h3>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div>
                            <h4 class="text-lg font-semibold text-indigo-700 mb-3">Project Goal</h4>
                            <p class="text-slate-700 leading-relaxed">
                                Develop machine learning models that can automatically recognize human emotions from brain activity patterns. 
                                This research uses EEG (electroencephalography) signals recorded while participants watched emotion-inducing film clips.
                            </p>
                        </div>
                        <div>
                            <h4 class="text-lg font-semibold text-indigo-700 mb-3">Applications</h4>
                            <ul class="text-slate-700 space-y-2">
                                <li>• Brain-computer interfaces</li>
                                <li>• Mental health monitoring</li>
                                <li>• Human-computer interaction</li>
                                <li>• Neurofeedback systems</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Data Structure Explanation -->
                <div class="bg-white rounded-xl shadow-lg border border-slate-200 p-8">
                    <h3 class="text-2xl font-bold text-slate-900 mb-6">🧠 3D Data Structure Explained</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 text-center">
                            <div class="text-3xl font-bold text-blue-600 mb-2">62</div>
                            <div class="text-sm font-medium text-blue-800">EEG Channels</div>
                            <div class="text-xs text-blue-600 mt-1">Brain electrode positions</div>
                        </div>
                        <div class="bg-green-50 border border-green-200 rounded-lg p-6 text-center">
                            <div class="text-3xl font-bold text-green-600 mb-2">5</div>
                            <div class="text-sm font-medium text-green-800">Frequency Bands</div>
                            <div class="text-xs text-green-600 mt-1">Delta, Theta, Alpha, Beta, Gamma</div>
                        </div>
                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-6 text-center">
                            <div class="text-3xl font-bold text-purple-600 mb-2">~42</div>
                            <div class="text-sm font-medium text-purple-800">Time Windows</div>
                            <div class="text-xs text-purple-600 mt-1">4-second segments</div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-r from-slate-50 to-blue-50 border border-slate-200 rounded-lg p-6">
                        <h4 class="text-lg font-semibold text-slate-800 mb-4">💡 Understanding the 3D Structure</h4>
                        <div class="space-y-3 text-sm text-slate-700">
                            <p><strong>Dimension 1 (62 Channels):</strong> Each channel represents an electrode placed on different parts of the scalp, capturing brain activity from various brain regions.</p>
                            <p><strong>Dimension 2 (5 Frequency Bands):</strong> Brain waves are analyzed across different frequency ranges, each associated with different cognitive and emotional states.</p>
                            <p><strong>Dimension 3 (Time Windows):</strong> The continuous EEG signal is divided into 4-second windows, creating temporal samples for analysis.</p>
                            <p><strong>Final Structure:</strong> 62 × 5 × ~42 = 13,020+ features per trial, capturing rich spatiotemporal brain patterns during emotional experiences.</p>
                        </div>
                    </div>
                </div>

                <!-- Processing Pipeline -->
                <div class="bg-white rounded-xl shadow-lg border border-slate-200 p-8">
                    <h3 class="text-2xl font-bold text-slate-900 mb-6">⚙️ Data Processing Pipeline</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <span class="text-2xl">🧠</span>
                            </div>
                            <h4 class="font-semibold text-slate-800">Raw EEG</h4>
                            <p class="text-xs text-slate-600 mt-1">62-channel brain signals recorded at 1000Hz</p>
                        </div>
                        <div class="text-center">
                            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <span class="text-2xl">🔧</span>
                            </div>
                            <h4 class="font-semibold text-slate-800">Preprocessing</h4>
                            <p class="text-xs text-slate-600 mt-1">Filtering, downsampling to 200Hz, artifact removal</p>
                        </div>
                        <div class="text-center">
                            <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <span class="text-2xl">📊</span>
                            </div>
                            <h4 class="font-semibold text-slate-800">Feature Extraction</h4>
                            <p class="text-xs text-slate-600 mt-1">Differential Entropy (DE) in 5 frequency bands</p>
                        </div>
                        <div class="text-center">
                            <div class="w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <span class="text-2xl">🤖</span>
                            </div>
                            <h4 class="font-semibold text-slate-800">ML Model</h4>
                            <p class="text-xs text-slate-600 mt-1">Train classifiers for 4 emotion categories</p>
                        </div>
                    </div>
                </div>

                <!-- Current Work Status -->
                <div class="bg-gradient-to-r from-indigo-50 to-blue-50 border border-indigo-200 rounded-xl p-8">
                    <h3 class="text-2xl font-bold text-indigo-900 mb-6">🚀 Current Work & Next Steps</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <h4 class="text-lg font-semibold text-indigo-800 mb-3">✅ Completed</h4>
                            <ul class="space-y-2 text-indigo-700">
                                <li>• Dataset download and organization</li>
                                <li>• Data structure analysis and understanding</li>
                                <li>• Feature extraction pipeline development</li>
                                <li>• CSV export functionality for processed features</li>
                                <li>• Interactive visualization website</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="text-lg font-semibold text-indigo-800 mb-3">🔄 In Progress / Next</h4>
                            <ul class="space-y-2 text-indigo-700">
                                <li>• Machine learning model development</li>
                                <li>• Cross-validation and performance evaluation</li>
                                <li>• Feature importance analysis</li>
                                <li>• Real-time emotion recognition system</li>
                                <li>• Academic paper preparation</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="explorer" class="py-16 section-fade-in">
            <div class="text-center">
                <h2 class="text-3xl font-bold text-slate-900 tracking-tight">Interactive Data Explorer</h2>
                <p class="mt-4 max-w-2xl mx-auto text-lg text-slate-600">Explore real processed EEG data from the SEED-IV dataset. Select parameters to see emotion labels and visualize brain signal patterns.</p>
            </div>

            <div class="mt-8 p-6 md:p-8 bg-white rounded-xl shadow-lg border border-slate-200">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label for="subjectSelect" class="block text-sm font-medium text-slate-700">Subject</label>
                        <select id="subjectSelect" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-slate-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"></select>
                    </div>
                    <div>
                        <label for="sessionSelect" class="block text-sm font-medium text-slate-700">Session</label>
                        <select id="sessionSelect" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-slate-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"></select>
                    </div>
                    <div>
                        <label for="trialSelect" class="block w-full text-sm font-medium text-slate-700">Trial</label>
                        <select id="trialSelect" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-slate-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"></select>
                    </div>
                    <div>
                        <label for="featureTypeSelect" class="block w-full text-sm font-medium text-slate-700">Feature Type</label>                        <select id="featureTypeSelect" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-slate-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                            <!-- Options will be populated dynamically based on trial selection -->
                        </select>
                    </div>
                </div>
                
                <div class="mt-8 flex flex-col md:flex-row items-center justify-center text-center p-4 rounded-lg bg-slate-100">
                    <p class="font-medium text-slate-800">Detected Emotion for Trial:</p>
                    <p id="emotionResult" class="ml-2 text-xl font-bold"></p>
                    <button id="describeEmotionBtn" class="ml-4 px-3 py-1.5 text-sm font-medium bg-indigo-600 text-white rounded-full hover:bg-indigo-700 transition-colors">✨ Describe Emotion</button>
                </div>
                <div id="emotionDescriptionResult" class="mt-4 p-4 bg-indigo-50 rounded-lg text-sm text-indigo-900"></div>
                <div id="emotionDescriptionLoading" class="mt-2 hidden flex items-center justify-center">
                    <div class="llm-loading-spinner"></div>
                </div>

                <div class="mt-8">
                    <div id="dataAvailabilityMessage" class="text-center text-red-500 font-medium my-4 hidden">
                        Actual data not found for this selection. Displaying simulated data.
                    </div>
                    <div class="chart-container">
                        <canvas id="explorerChart"></canvas>
                    </div>
                    <!-- Container for CSV table data -->
                    <div id="csv-data-display" class="mt-6 overflow-x-auto">
                        <h4 class="text-lg font-semibold text-slate-800 mb-2">Raw CSV Data (First few rows/columns)</h4>
                        <p class="text-slate-500 text-sm italic">Data for channel 1 shown in chart above.</p>
                        <!-- CSV data will be loaded here -->
                    </div>
                </div>
            </div>
        </section>

    </main>
    
    <footer class="bg-slate-800 text-white mt-16">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center text-sm">
            <p>Interactive guide developed to explore the SEED-IV Dataset.</p>
            <p class="text-slate-400 mt-1">Source: Center for Brain-like Computing and Machine Intelligence, SJTU.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const appData = {
                demographics: {
                    labels: ['Female', 'Male'],
                    data: [9, 6],
                    colors: ['#818cf8', '#60a5fa'] // indigo-400, sky-400
                },
                eegBands: [
                    { name: 'Delta', range: '1-4 Hz', desc: 'Deep sleep, unconscious processes, meditation' },
                    { name: 'Theta', range: '4-8 Hz', desc: 'Drowsiness, memory processing, emotional arousal' },
                    { name: 'Alpha', range: '8-14 Hz', desc: 'Relaxation, reduced attention, eyes closed' },
                    { name: 'Beta', range: '14-31 Hz', desc: 'Active thinking, alertness, anxiety, problem-solving' },
                    { name: 'Gamma', range: '31-50 Hz', desc: 'Higher-level cognitive functions, attention, perception' }
                ],
                eyeFeatures: [
                    { name: 'Pupil Diameter', desc: 'Reflects arousal and visual attention. Includes average pupil size and gaze coordinates.'},
                    { name: 'Dispersion', desc: 'Related to the spread or stability of gaze, indicating visual exploration or focus.'},
                    { name: 'Fixation Duration', desc: 'The duration of periods where the eye remains relatively still, indicating information intake.'},
                    { name: 'Saccade', desc: 'Parameters of rapid eye movements between fixations, like duration and amplitude.'},
                    { name: 'Event Statistics', desc: 'Aggregated statistics from various eye-tracking events, providing a high-level behavioral summary.'}
                ],
                emotions: {
                    0: { name: 'Neutral', color: '#64748b' }, // slate-500
                    1: { name: 'Sad', color: '#3b82f6' },   // blue-500
                    2: { name: 'Fear', color: '#ef4444' },  // red-500
                    3: { name: 'Happy', color: '#f97316' }  // orange-500
                },
                sessionLabels: {
                    1: [1, 2, 3, 0, 2, 0, 0, 1, 0, 1, 2, 1, 1, 1, 2, 3, 2, 2, 3, 3, 0, 3, 0, 3],
                    2: [2, 1, 3, 0, 0, 2, 0, 2, 3, 3, 2, 3, 2, 0, 1, 1, 2, 1, 0, 3, 0, 1, 3, 1],
                    3: [1, 2, 2, 1, 3, 3, 3, 1, 1, 2, 1, 0, 2, 3, 3, 0, 2, 3, 0, 0, 2, 0, 1, 0]                }
            };            // Mapping for CSV files based on organized folder structure
            // Format: csv/subject/session/feature.csv
            // Note: The number in the feature key (e.g., de_movingAve2) corresponds to the trial number
            const csvFileMap = {
                // Trial 1 examples
                'Subject_1_Session_1_Trial_1_de_movingAve1': 'csv/1/1/de_movingAve1.csv',
                'Subject_1_Session_1_Trial_1_de_LDS1': 'csv/1/1/de_LDS1.csv',
                
                // Trial 2 examples
                'Subject_1_Session_1_Trial_2_de_movingAve2': 'csv/1/1/de_movingAve2.csv',
                
                // Other subjects examples
                'Subject_1_Session_1_Trial_24_de_movingAve24': 'csv/1/1/de_movingAve24.csv',
                'Subject_2_Session_1_Trial_1_de_movingAve1': 'csv/1/1/de_movingAve1.csv',
                'Subject_1_Session_2_Trial_1_de_movingAve1': 'csv/2/1/de_movingAve1.csv',
            };

            // Function to generate CSV file path from organized structure
            function generateCSVPath(subject, session, trial, featureType) {
                // First try the organized structure: csv/subject/session/feature.csv
                const organizedPath = `csv/${subject}/${session}/${featureType}.csv`;
                
                // Create the key for the csvFileMap (matches the correct trial)
                const csvKey = `Subject_${subject}_Session_${session}_Trial_${trial}_${featureType}`;
                
                // Check if there's a specific mapping in csvFileMap, otherwise use organized path
                return csvFileMap[csvKey] || organizedPath;
            }

            // --- Navigation and Section Visibility ---
            const sections = document.querySelectorAll('section');
            const navLinks = document.querySelectorAll('.nav-link');

            const observerOptions = {
                root: null,
                rootMargin: '0px',
                threshold: 0.2
            };

            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                        // Update active nav link
                        navLinks.forEach(link => {
                            link.classList.remove('active-nav-link');
                            if (link.getAttribute('href') === `#${entry.target.id}`) {
                                link.classList.add('active-nav-link');
                            }
                        });
                    } else {
                        entry.target.classList.remove('visible');
                    }
                });
            }, observerOptions);

            sections.forEach(section => {
                observer.observe(section);
            });

            // Smooth scrolling for navigation links
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.querySelector(this.getAttribute('href')).scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });

            // --- Demographics Chart ---
            const demographicsCtx = document.getElementById('demographicsChart').getContext('2d');
            new Chart(demographicsCtx, {
                type: 'doughnut',
                data: {
                    labels: appData.demographics.labels,
                    datasets: [{
                        data: appData.demographics.data,
                        backgroundColor: appData.demographics.colors,
                        hoverOffset: 10,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: {
                                    family: 'Inter',
                                },
                                color: '#334155' // slate-700
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        label += context.parsed;
                                    }
                                    return label + ' subjects';
                                }
                            },
                            bodyFont: {
                                family: 'Inter',
                            },
                            titleFont: {
                                family: 'Inter',
                            }
                        }
                    }
                }
            });

            // --- EEG Frequency Bands Interaction ---
            const eegBandButtonsContainer = document.getElementById('eegBandButtons');
            const eegBandInfo = document.getElementById('eegBandInfo');
            const eegBandDeepDiveBtn = document.getElementById('eegBandDeepDiveBtn');
            const eegBandDeepDiveResult = document.getElementById('eegBandDeepDiveResult');
            const eegBandDeepDiveLoading = document.getElementById('eegBandDeepDiveLoading');
            let selectedBand = null;

            appData.eegBands.forEach(band => {
                const button = document.createElement('button');
                button.textContent = band.name;
                button.className = 'px-4 py-2 rounded-full border border-indigo-300 text-indigo-700 bg-indigo-50 hover:bg-indigo-100 transition-colors text-sm font-medium';
                button.addEventListener('click', () => {
                    // Reset button styles
                    document.querySelectorAll('#eegBandButtons button').forEach(btn => {
                        btn.classList.remove('bg-indigo-600', 'text-white');
                        btn.classList.add('bg-indigo-50', 'text-indigo-700');
                    });
                    // Set active button style
                    button.classList.add('bg-indigo-600', 'text-white');
                    button.classList.remove('bg-indigo-50', 'text-indigo-700');

                    eegBandInfo.innerHTML = `<p class="font-semibold text-indigo-800">${band.name} Band (${band.range}):</p><p class="text-indigo-700 mt-1">${band.desc}</p>`;
                    eegBandDeepDiveBtn.classList.remove('hidden');
                    eegBandDeepDiveResult.textContent = '';
                    selectedBand = band;
                });
                eegBandButtonsContainer.appendChild(button);
            });

            eegBandDeepDiveBtn.addEventListener('click', async () => {
                if (!selectedBand) return;

                eegBandDeepDiveResult.textContent = '';
                eegBandDeepDiveLoading.classList.remove('hidden');
                eegBandDeepDiveBtn.disabled = true;

                try {
                    const prompt = `Provide a more detailed explanation of the "${selectedBand.name}" EEG frequency band (${selectedBand.range}), including its common associations with brain states, cognitive functions, and any clinical relevance. Keep it concise, around 100-150 words.`;
                    const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                    const apiKey = ""; // Canvas will provide this
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                        eegBandDeepDiveResult.textContent = result.candidates[0].content.parts[0].text;
                    } else {
                        eegBandDeepDiveResult.textContent = 'Could not get a detailed description.';
                    }
                } catch (error) {
                    console.error('Error fetching LLM description:', error);
                    eegBandDeepDiveResult.textContent = 'Failed to load description. Please try again.';
                } finally {
                    eegBandDeepDiveLoading.classList.add('hidden');
                    eegBandDeepDiveBtn.disabled = false;
                }
            });

            // --- Dimension Block Hover Effect ---
            const dimensionBlocks = document.querySelectorAll('.dimension-block');
            const dimensionDesc = document.getElementById('dimension-desc');
            const originalDesc = dimensionDesc.textContent;

            dimensionBlocks.forEach(block => {
                block.addEventListener('mouseenter', () => {
                    dimensionDesc.textContent = block.dataset.desc;
                });
                block.addEventListener('mouseleave', () => {
                    dimensionDesc.textContent = originalDesc;
                });
            });

            // --- Eye Movement Features Interaction ---
            const eyeFeatureListContainer = document.getElementById('eyeFeatureList');
            appData.eyeFeatures.forEach((feature, index) => {
                const featureDiv = document.createElement('div');
                featureDiv.className = 'p-4 bg-white rounded-lg shadow-sm border border-slate-200 cursor-pointer transition-shadow hover:shadow-md';
                featureDiv.innerHTML = `
                    <p class="font-bold text-slate-800">${feature.name}</p>
                    <p class="text-sm text-slate-500 mt-1 hidden" id="eye-feature-desc-${index}">${feature.desc}</p>
                `;
                featureDiv.addEventListener('click', () => {
                    const descElement = document.getElementById(`eye-feature-desc-${index}`);
                    descElement.classList.toggle('hidden');
                });
                eyeFeatureListContainer.appendChild(featureDiv);
            });


            // --- Tab Switching Logic (EEG vs Eye Movement) ---
            const tabEeg = document.getElementById('tab-eeg');
            const tabEye = document.getElementById('tab-eye');
            const contentEeg = document.getElementById('content-eeg');
            const contentEye = document.getElementById('content-eye');

            tabEeg.addEventListener('click', () => {
                tabEeg.classList.add('border-indigo-600', 'text-indigo-600');
                tabEeg.classList.remove('border-transparent', 'text-slate-500');
                tabEye.classList.remove('border-indigo-600', 'text-indigo-600');
                tabEye.classList.add('border-transparent', 'text-slate-500');
                contentEeg.classList.remove('hidden');
                contentEye.classList.add('hidden');
            });

            tabEye.addEventListener('click', () => {
                tabEye.classList.add('border-indigo-600', 'text-indigo-600');
                tabEye.classList.remove('border-transparent', 'text-slate-500');
                tabEeg.classList.remove('border-indigo-600', 'text-indigo-600');
                tabEeg.classList.add('border-transparent', 'text-slate-500');
                contentEye.classList.remove('hidden');
                contentEeg.classList.add('hidden');
            });

            // --- Interactive Data Explorer Logic ---
            const subjectSelect = document.getElementById('subjectSelect');
            const sessionSelect = document.getElementById('sessionSelect');
            const trialSelect = document.getElementById('trialSelect');
            const featureTypeSelect = document.getElementById('featureTypeSelect');
            const emotionResult = document.getElementById('emotionResult');
            const describeEmotionBtn = document.getElementById('describeEmotionBtn');
            const emotionDescriptionResult = document.getElementById('emotionDescriptionResult');
            const emotionDescriptionLoading = document.getElementById('emotionDescriptionLoading');
            const dataAvailabilityMessage = document.getElementById('dataAvailabilityMessage');
            const csvDataDisplay = document.getElementById('csv-data-display');

            let explorerChart; // Chart instance for the explorer

            // Populate subject dropdown (1 to 15)
            for (let i = 1; i <= 15; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `Subject ${i}`;
                subjectSelect.appendChild(option);
            }

            // Populate session dropdown (1 to 3)
            for (let i = 1; i <= 3; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `Session ${i}`;
                sessionSelect.appendChild(option);
            }

            // Populate trial dropdown (1 to 24)
            for (let i = 1; i <= 24; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `Trial ${i}`;
                trialSelect.appendChild(option);
            }            // Function to parse CSV data
            function parseCSV(csvText) {
                const lines = csvText.trim().split('\n');
                const headers = lines[0].split(',');
                const data = [];
                
                for (let i = 1; i < lines.length; i++) {
                    const values = lines[i].split(',').map(val => parseFloat(val));
                    data.push(values);
                }
                
                return { headers, data };
            }

            // Function to analyze data structure and create educational summary
            function analyzeDataStructure(headers, data) {
                const channels = 62;
                const frequencies = 5;
                const timeWindows = data.length;
                
                return {
                    totalFeatures: headers.length,
                    channels: channels,
                    frequencies: frequencies,
                    timeWindows: timeWindows,
                    totalDataPoints: headers.length * timeWindows,
                    structure: `${channels} channels × ${frequencies} frequency bands × ${timeWindows} time windows`,
                    description: `This represents EEG brain activity data where each of the ${channels} electrode channels captures brain signals across ${frequencies} different frequency bands (Delta, Theta, Alpha, Beta, Gamma) over ${timeWindows} time windows of 4 seconds each.`
                };
            }

            // Function to extract channel data for visualization
            function extractChannelData(data, channelIndex, frequencyIndex) {
                const columnIndex = channelIndex * 5 + frequencyIndex;
                return data.map(row => row[columnIndex]);
            }

            // Function to calculate statistics for educational purposes
            function calculateStatistics(values) {
                const mean = values.reduce((a, b) => a + b, 0) / values.length;
                const sorted = [...values].sort((a, b) => a - b);
                const median = sorted[Math.floor(sorted.length / 2)];
                const min = Math.min(...values);
                const max = Math.max(...values);
                const std = Math.sqrt(values.reduce((sq, n) => sq + Math.pow(n - mean, 2), 0) / values.length);
                
                return { mean, median, min, max, std };
            }            // Function to update the explorer chart and emotion label
            async function updateExplorerChart() {
                const subject = subjectSelect.value;
                const session = sessionSelect.value;
                const trial = trialSelect.value;
                const featureType = featureTypeSelect.value;

                // Create main explorer chart (shows overview visualization)
                const explorerCanvas = document.getElementById('explorerChart');
                const ctx = explorerCanvas.getContext('2d');

                // Destroy existing chart if it exists
                if (explorerChart) {
                    explorerChart.destroy();
                }

                // Create a simple overview chart showing the SEED-IV emotion categories
                explorerChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Happy', 'Sad', 'Fear', 'Neutral'],
                        datasets: [{
                            data: [25, 25, 25, 25], // Equal distribution for illustration
                            backgroundColor: ['#22c55e', '#3b82f6', '#f59e0b', '#6b7280'],
                            borderWidth: 2,
                            borderColor: '#ffffff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true
                                }
                            },
                            title: {
                                display: true,
                                text: 'SEED-IV Emotion Categories',
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                });

                // Determine emotion label based on session and trial
                if (appData.sessionLabels[session] && trial >= 1 && trial <= 24) {
                    const emotionLabel = appData.sessionLabels[session][trial - 1];
                    const emotion = appData.emotions[emotionLabel];
                    emotionResult.innerHTML = `
                        <div class="flex items-center gap-3">
                            <div class="w-4 h-4 rounded-full" style="background-color: ${emotion.color}"></div>
                            <span class="font-semibold text-lg">${emotion.name}</span>
                            <span class="text-sm text-slate-500">(Label: ${emotionLabel})</span>
                        </div>
                    `;
                    describeEmotionBtn.dataset.emotionName = emotion.name;
                    describeEmotionBtn.classList.remove('hidden');                } else {
                    emotionResult.innerHTML = '<span class="text-slate-500">Select valid parameters to see emotion label</span>';
                    describeEmotionBtn.classList.add('hidden');
                }                // Check if CSV data is available
                const csvFile = generateCSVPath(subject, session, trial, featureType);
                
                try {
                    // Try to load the CSV file
                    const response = await fetch(csvFile);
                    
                    if (response.ok) {
                        dataAvailabilityMessage.innerHTML = `
                            <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                <div class="flex items-center gap-2">
                                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                    <span class="text-green-800 font-medium">Data Available: ${csvFile}</span>
                                </div>
                                <p class="text-green-700 text-sm mt-1">Loading and analyzing EEG data structure...</p>
                            </div>
                        `;
                        
                        // Load and display CSV data
                        const csvText = await response.text();
                        const { headers, data } = parseCSV(csvText);
                        const analysis = analyzeDataStructure(headers, data);
                        
                        // Display data structure information
                        csvDataDisplay.innerHTML = `
                            <div class="space-y-6">
                                <!-- Data Structure Overview -->
                                <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                                    <h3 class="text-lg font-bold text-blue-900 mb-4">📊 Dataset Structure Analysis</h3>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="space-y-2">
                                            <div class="flex justify-between">
                                                <span class="text-blue-700">Total Features:</span>
                                                <span class="font-mono text-blue-900">${analysis.totalFeatures}</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-blue-700">EEG Channels:</span>
                                                <span class="font-mono text-blue-900">${analysis.channels}</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-blue-700">Frequency Bands:</span>
                                                <span class="font-mono text-blue-900">${analysis.frequencies}</span>
                                            </div>
                                        </div>
                                        <div class="space-y-2">
                                            <div class="flex justify-between">
                                                <span class="text-blue-700">Time Windows:</span>
                                                <span class="font-mono text-blue-900">${analysis.timeWindows}</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-blue-700">Total Data Points:</span>
                                                <span class="font-mono text-blue-900">${analysis.totalDataPoints.toLocaleString()}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-4 p-3 bg-white rounded border">
                                        <p class="text-sm text-blue-800"><strong>Structure:</strong> ${analysis.structure}</p>
                                        <p class="text-sm text-blue-700 mt-2">${analysis.description}</p>
                                    </div>
                                </div>

                                <!-- Sample Data Visualization -->
                                <div class="bg-white border border-slate-200 rounded-lg p-6">
                                    <h3 class="text-lg font-bold text-slate-900 mb-4">🧠 EEG Channel Visualization</h3>
                                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                        <!-- Channel Selection -->
                                        <div>
                                            <label class="block text-sm font-medium text-slate-700 mb-2">Select Channel & Frequency:</label>
                                            <div class="space-y-3">
                                                <select id="channelSelect" class="w-full px-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                                    ${Array.from({length: 62}, (_, i) => `<option value="${i}">Channel ${i + 1}</option>`).join('')}
                                                </select>
                                                <select id="frequencySelect" class="w-full px-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                                    <option value="0">Delta (1-4 Hz)</option>
                                                    <option value="1">Theta (4-8 Hz)</option>
                                                    <option value="2">Alpha (8-14 Hz)</option>
                                                    <option value="3">Beta (14-31 Hz)</option>
                                                    <option value="4">Gamma (31-50 Hz)</option>
                                                </select>
                                            </div>
                                            <div id="channelStats" class="mt-4 p-3 bg-slate-50 rounded text-sm"></div>
                                        </div>
                                        
                                        <!-- Mini Chart -->
                                        <div>
                                            <canvas id="miniChart" width="400" height="300"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <!-- Educational Information -->
                                <div class="bg-amber-50 border border-amber-200 rounded-lg p-6">
                                    <h3 class="text-lg font-bold text-amber-900 mb-4">🎓 Understanding This Data</h3>
                                    <div class="space-y-3 text-sm text-amber-800">
                                        <p><strong>What you're seeing:</strong> This data represents brain electrical activity (EEG) captured during emotional stimulus presentation.</p>
                                        <p><strong>Each row:</strong> Represents a 4-second time window of brain activity.</p>
                                        <p><strong>Each column:</strong> Represents a specific brain location (channel) and frequency band combination.</p>
                                        <p><strong>Values:</strong> Differential Entropy (DE) features that measure the complexity/information content of brain signals.</p>
                                        <p><strong>Research Goal:</strong> Use this structured data to train machine learning models that can automatically recognize emotions from brain signals.</p>
                                    </div>
                                </div>
                            </div>
                        `;
                          // Setup interactive channel visualization
                        setupChannelVisualization(data, headers);
                        
                    } else {
                        // File not found (404 or other error status)
                        dataAvailabilityMessage.innerHTML = `
                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                                <div class="flex items-center gap-2">
                                    <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                                    <span class="text-yellow-800 font-medium">CSV File Not Found</span>
                                </div>
                                <p class="text-yellow-700 text-sm mt-1">Expected file: ${csvFile}</p>
                                <p class="text-yellow-600 text-xs mt-1">Convert your MATLAB data using the conversion script to generate this file.</p>
                            </div>
                        `;
                        csvDataDisplay.innerHTML = '';
                    }
                    
                } catch (error) {
                    console.error('Error loading CSV data:', error);
                    dataAvailabilityMessage.innerHTML = `
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                            <div class="flex items-center gap-2">
                                <div class="w-2 h-2 bg-red-500 rounded-full"></div>
                                <span class="text-red-800 font-medium">Error Loading Data</span>
                            </div>
                            <p class="text-red-700 text-sm mt-1">Could not access ${csvFile}. Please check if the file exists and the server is running.</p>
                        </div>
                    `;
                    csvDataDisplay.innerHTML = '';
                }
            }

            // Function to setup interactive channel visualization
            function setupChannelVisualization(data, headers) {
                const channelSelect = document.getElementById('channelSelect');
                const frequencySelect = document.getElementById('frequencySelect');
                const channelStats = document.getElementById('channelStats');
                const miniChartCanvas = document.getElementById('miniChart');
                
                let miniChart;
                
                function updateChannelVisualization() {
                    const channelIndex = parseInt(channelSelect.value);
                    const frequencyIndex = parseInt(frequencySelect.value);
                    const channelData = extractChannelData(data, channelIndex, frequencyIndex);
                    const stats = calculateStatistics(channelData);
                    const freqNames = ['Delta', 'Theta', 'Alpha', 'Beta', 'Gamma'];
                    
                    // Update statistics display
                    channelStats.innerHTML = `
                        <div class="space-y-1">
                            <div class="font-medium text-slate-700">Channel ${channelIndex + 1} - ${freqNames[frequencyIndex]} Band Statistics:</div>
                            <div class="grid grid-cols-2 gap-2 text-xs">
                                <div>Mean: <span class="font-mono">${stats.mean.toFixed(2)}</span></div>
                                <div>Std Dev: <span class="font-mono">${stats.std.toFixed(2)}</span></div>
                                <div>Min: <span class="font-mono">${stats.min.toFixed(2)}</span></div>
                                <div>Max: <span class="font-mono">${stats.max.toFixed(2)}</span></div>
                            </div>
                        </div>
                    `;
                    
                    // Update mini chart
                    const ctx = miniChartCanvas.getContext('2d');
                    
                    if (miniChart) {
                        miniChart.destroy();
                    }
                    
                    miniChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: Array.from({length: channelData.length}, (_, i) => `${(i + 1) * 4}s`),
                            datasets: [{
                                label: `CH${channelIndex + 1} ${freqNames[frequencyIndex]}`,
                                data: channelData,
                                borderColor: '#6366f1',
                                backgroundColor: 'rgba(99, 102, 241, 0.1)',
                                borderWidth: 2,
                                fill: true,
                                tension: 0.3
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: true
                                },
                                title: {
                                    display: true,
                                    text: `EEG Signal Over Time (Differential Entropy)`
                                }
                            },
                            scales: {
                                y: {
                                    title: {
                                        display: true,
                                        text: 'DE Value'
                                    }
                                },
                                x: {
                                    title: {
                                        display: true,
                                        text: 'Time Windows (4s each)'
                                    }
                                }
                            }
                        }
                    });
                }
                
                // Initial visualization
                updateChannelVisualization();
                
                // Add event listeners
                channelSelect.addEventListener('change', updateChannelVisualization);
                frequencySelect.addEventListener('change', updateChannelVisualization);
            }

            // Event listeners for dropdown changes
            subjectSelect.addEventListener('change', updateExplorerChart);
            sessionSelect.addEventListener('change', updateExplorerChart);
            trialSelect.addEventListener('change', () => {
                updateExplorerChart();
                updateFeatureTypeOptions();
            });
            featureTypeSelect.addEventListener('change', updateExplorerChart);

            // Function to update feature type dropdown based on selected trial
            function updateFeatureTypeOptions() {
                const trial = trialSelect.value;
                const featureTypeSelect = document.getElementById('featureTypeSelect');
                
                // Clear existing options
                featureTypeSelect.innerHTML = '';
                
                if (trial) {
                    const featureOptions = [
                        { value: `de_movingAve${trial}`, label: 'DE (Moving Average)' },
                        { value: `de_LDS${trial}`, label: 'DE (LDS)' },
                        { value: `psd_movingAve${trial}`, label: 'PSD (Moving Average)' },
                        { value: `psd_LDS${trial}`, label: 'PSD (LDS)' }
                    ];
                    
                    featureOptions.forEach(option => {
                        const optionElement = document.createElement('option');
                        optionElement.value = option.value;
                        optionElement.textContent = option.label;
                        featureTypeSelect.appendChild(optionElement);
                    });
                    
                    // Trigger chart update if there's a selected value
                    if (featureTypeSelect.value) {
                        updateExplorerChart();
                    }
                }
            }

            // LLM call for emotion description
            describeEmotionBtn.addEventListener('click', async () => {
                const emotionName = describeEmotionBtn.dataset.emotionName;
                if (!emotionName || emotionName === 'N/A') return;

                emotionDescriptionResult.textContent = '';
                emotionDescriptionLoading.classList.remove('hidden');
                describeEmotionBtn.disabled = true;

                try {
                    const prompt = `Provide a brief, general description of the emotion "${emotionName}", including how it typically manifests in humans psychologically and physiologically. Keep it concise, around 80-120 words.`;
                    const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                    const apiKey = "AIzaSyDhFRxIi6RXM-54EZh7TIEvAtgdZ8UiNs4"; 
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                        emotionDescriptionResult.textContent = result.candidates[0].content.parts[0].text;
                    } else {
                        emotionDescriptionResult.textContent = 'Could not get a detailed description.';
                    }
                } catch (error) {
                    console.error('Error fetching LLM emotion description:', error);
                    emotionDescriptionResult.textContent = 'Failed to load description. Please try again.';                } finally {
                    emotionDescriptionLoading.classList.add('hidden');                    describeEmotionBtn.disabled = false;
                }
            });

            // Initial setup
            updateFeatureTypeOptions();
            updateExplorerChart();
        });
    </script>
</body>
</html>
